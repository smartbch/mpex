use std::ops::Add;

use revm::primitives::{hex::FromHex, Address, Bytes, TransactTo, TxEnv, U256};

pub fn create_deploy_erc20_tx(caller: &Address) -> TxEnv {
    let mut tx = TxEnv::default();
    tx.caller = caller.clone();
    tx.transact_to = TransactTo::create();
    let erc20_deploy_hex ="0x60806040523480156200001157600080fd5b5060405162001e1738038062001e1783398181016040528101906200003791906200041d565b828281600390816200004a919062000702565b5080600490816200005c919062000702565b50505080600560006101000a81548160ff021916908360ff160217905550620000ac337fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff620000b560201b60201c565b50505062000926565b620000c78282620000cb60201b60201c565b5050565b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff16036200013d576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040162000134906200084a565b60405180910390fd5b62000151600083836200023860201b60201c565b80600260008282546200016591906200089b565b92505081905550806000808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082825401925050819055508173ffffffffffffffffffffffffffffffffffffffff16600073ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef8360405162000218919062000909565b60405180910390a362000234600083836200023d60201b60201c565b5050565b505050565b505050565b6000604051905090565b600080fd5b600080fd5b600080fd5b600080fd5b6000601f19601f8301169050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b620002ab8262000260565b810181811067ffffffffffffffff82111715620002cd57620002cc62000271565b5b80604052505050565b6000620002e262000242565b9050620002f08282620002a0565b919050565b600067ffffffffffffffff82111562000313576200031262000271565b5b6200031e8262000260565b9050602081019050919050565b60005b838110156200034b5780820151818401526020810190506200032e565b838111156200035b576000848401525b50505050565b6000620003786200037284620002f5565b620002d6565b9050828152602081018484840111156200039757620003966200025b565b5b620003a48482856200032b565b509392505050565b600082601f830112620003c457620003c362000256565b5b8151620003d684826020860162000361565b91505092915050565b600060ff82169050919050565b620003f781620003df565b81146200040357600080fd5b50565b6000815190506200041781620003ec565b92915050565b6000806000606084860312156200043957620004386200024c565b5b600084015167ffffffffffffffff8111156200045a576200045962000251565b5b6200046886828701620003ac565b935050602084015167ffffffffffffffff8111156200048c576200048b62000251565b5b6200049a86828701620003ac565b9250506040620004ad8682870162000406565b9150509250925092565b600081519050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b600060028204905060018216806200050a57607f821691505b60208210810362000520576200051f620004c2565b5b50919050565b60008190508160005260206000209050919050565b60006020601f8301049050919050565b600082821b905092915050565b6000600883026200058a7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff826200054b565b6200059686836200054b565b95508019841693508086168417925050509392505050565b6000819050919050565b6000819050919050565b6000620005e3620005dd620005d784620005ae565b620005b8565b620005ae565b9050919050565b6000819050919050565b620005ff83620005c2565b620006176200060e82620005ea565b84845462000558565b825550505050565b600090565b6200062e6200061f565b6200063b818484620005f4565b505050565b5b8181101562000663576200065760008262000624565b60018101905062000641565b5050565b601f821115620006b2576200067c8162000526565b62000687846200053b565b8101602085101562000697578190505b620006af620006a6856200053b565b83018262000640565b50505b505050565b600082821c905092915050565b6000620006d760001984600802620006b7565b1980831691505092915050565b6000620006f28383620006c4565b9150826002028217905092915050565b6200070d82620004b7565b67ffffffffffffffff81111562000729576200072862000271565b5b620007358254620004f1565b6200074282828562000667565b600060209050601f8311600181146200077a576000841562000765578287015190505b620007718582620006e4565b865550620007e1565b601f1984166200078a8662000526565b60005b82811015620007b4578489015182556001820191506020850194506020810190506200078d565b86831015620007d45784890151620007d0601f891682620006c4565b8355505b6001600288020188555050505b505050505050565b600082825260208201905092915050565b7f45524332303a206d696e7420746f20746865207a65726f206164647265737300600082015250565b600062000832601f83620007e9565b91506200083f82620007fa565b602082019050919050565b60006020820190508181036000830152620008658162000823565b9050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b6000620008a882620005ae565b9150620008b583620005ae565b9250827fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff03821115620008ed57620008ec6200086c565b5b828201905092915050565b6200090381620005ae565b82525050565b6000602082019050620009206000830184620008f8565b92915050565b6114e180620009366000396000f3fe6080604052600436106100a75760003560e01c806340c10f191161006457806340c10f19146101e457806370a082311461020057806395d89b411461023d578063a457c2d714610268578063a9059cbb146102a5578063dd62ed3e146102e2576100a7565b806306fdde03146100ac578063095ea7b3146100d757806318160ddd1461011457806323b872dd1461013f578063313ce5671461017c57806339509351146101a7575b600080fd5b3480156100b857600080fd5b506100c161031f565b6040516100ce9190610d30565b60405180910390f35b3480156100e357600080fd5b506100fe60048036038101906100f99190610deb565b6103b1565b60405161010b9190610e46565b60405180910390f35b34801561012057600080fd5b506101296103d4565b6040516101369190610e70565b60405180910390f35b34801561014b57600080fd5b5061016660048036038101906101619190610e8b565b6103de565b6040516101739190610e46565b60405180910390f35b34801561018857600080fd5b5061019161040d565b60405161019e9190610efa565b60405180910390f35b3480156101b357600080fd5b506101ce60048036038101906101c99190610deb565b610424565b6040516101db9190610e46565b60405180910390f35b6101fe60048036038101906101f99190610deb565b61045b565b005b34801561020c57600080fd5b5061022760048036038101906102229190610f15565b610469565b6040516102349190610e70565b60405180910390f35b34801561024957600080fd5b506102526104b1565b60405161025f9190610d30565b60405180910390f35b34801561027457600080fd5b5061028f600480360381019061028a9190610deb565b610543565b60405161029c9190610e46565b60405180910390f35b3480156102b157600080fd5b506102cc60048036038101906102c79190610deb565b6105ba565b6040516102d99190610e46565b60405180910390f35b3480156102ee57600080fd5b5061030960048036038101906103049190610f42565b6105dd565b6040516103169190610e70565b60405180910390f35b60606003805461032e90610fb1565b80601f016020809104026020016040519081016040528092919081815260200182805461035a90610fb1565b80156103a75780601f1061037c576101008083540402835291602001916103a7565b820191906000526020600020905b81548152906001019060200180831161038a57829003601f168201915b5050505050905090565b6000806103bc610664565b90506103c981858561066c565b600191505092915050565b6000600254905090565b6000806103e9610664565b90506103f6858285610835565b6104018585856108c1565b60019150509392505050565b6000600560009054906101000a900460ff16905090565b60008061042f610664565b905061045081858561044185896105dd565b61044b9190611011565b61066c565b600191505092915050565b6104658282610b37565b5050565b60008060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020549050919050565b6060600480546104c090610fb1565b80601f01602080910402602001604051908101604052809291908181526020018280546104ec90610fb1565b80156105395780601f1061050e57610100808354040283529160200191610539565b820191906000526020600020905b81548152906001019060200180831161051c57829003601f168201915b5050505050905090565b60008061054e610664565b9050600061055c82866105dd565b9050838110156105a1576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610598906110d9565b60405180910390fd5b6105ae828686840361066c565b60019250505092915050565b6000806105c5610664565b90506105d28185856108c1565b600191505092915050565b6000600160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054905092915050565b600033905090565b600073ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff16036106db576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016106d29061116b565b60405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff160361074a576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610741906111fd565b60405180910390fd5b80600160008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055508173ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff167f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925836040516108289190610e70565b60405180910390a3505050565b600061084184846105dd565b90507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff81146108bb57818110156108ad576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016108a490611269565b60405180910390fd5b6108ba848484840361066c565b5b50505050565b600073ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff1603610930576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610927906112fb565b60405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff160361099f576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016109969061138d565b60405180910390fd5b6109aa838383610c8d565b60008060008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054905081811015610a30576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610a279061141f565b60405180910390fd5b8181036000808673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002081905550816000808573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082825401925050819055508273ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef84604051610b1e9190610e70565b60405180910390a3610b31848484610c92565b50505050565b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff1603610ba6576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610b9d9061148b565b60405180910390fd5b610bb260008383610c8d565b8060026000828254610bc49190611011565b92505081905550806000808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082825401925050819055508173ffffffffffffffffffffffffffffffffffffffff16600073ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef83604051610c759190610e70565b60405180910390a3610c8960008383610c92565b5050565b505050565b505050565b600081519050919050565b600082825260208201905092915050565b60005b83811015610cd1578082015181840152602081019050610cb6565b83811115610ce0576000848401525b50505050565b6000601f19601f8301169050919050565b6000610d0282610c97565b610d0c8185610ca2565b9350610d1c818560208601610cb3565b610d2581610ce6565b840191505092915050565b60006020820190508181036000830152610d4a8184610cf7565b905092915050565b600080fd5b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000610d8282610d57565b9050919050565b610d9281610d77565b8114610d9d57600080fd5b50565b600081359050610daf81610d89565b92915050565b6000819050919050565b610dc881610db5565b8114610dd357600080fd5b50565b600081359050610de581610dbf565b92915050565b60008060408385031215610e0257610e01610d52565b5b6000610e1085828601610da0565b9250506020610e2185828601610dd6565b9150509250929050565b60008115159050919050565b610e4081610e2b565b82525050565b6000602082019050610e5b6000830184610e37565b92915050565b610e6a81610db5565b82525050565b6000602082019050610e856000830184610e61565b92915050565b600080600060608486031215610ea457610ea3610d52565b5b6000610eb286828701610da0565b9350506020610ec386828701610da0565b9250506040610ed486828701610dd6565b9150509250925092565b600060ff82169050919050565b610ef481610ede565b82525050565b6000602082019050610f0f6000830184610eeb565b92915050565b600060208284031215610f2b57610f2a610d52565b5b6000610f3984828501610da0565b91505092915050565b60008060408385031215610f5957610f58610d52565b5b6000610f6785828601610da0565b9250506020610f7885828601610da0565b9150509250929050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b60006002820490506001821680610fc957607f821691505b602082108103610fdc57610fdb610f82565b5b50919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b600061101c82610db5565b915061102783610db5565b9250827fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0382111561105c5761105b610fe2565b5b828201905092915050565b7f45524332303a2064656372656173656420616c6c6f77616e63652062656c6f7760008201527f207a65726f000000000000000000000000000000000000000000000000000000602082015250565b60006110c3602583610ca2565b91506110ce82611067565b604082019050919050565b600060208201905081810360008301526110f2816110b6565b9050919050565b7f45524332303a20617070726f76652066726f6d20746865207a65726f2061646460008201527f7265737300000000000000000000000000000000000000000000000000000000602082015250565b6000611155602483610ca2565b9150611160826110f9565b604082019050919050565b6000602082019050818103600083015261118481611148565b9050919050565b7f45524332303a20617070726f766520746f20746865207a65726f20616464726560008201527f7373000000000000000000000000000000000000000000000000000000000000602082015250565b60006111e7602283610ca2565b91506111f28261118b565b604082019050919050565b60006020820190508181036000830152611216816111da565b9050919050565b7f45524332303a20696e73756666696369656e7420616c6c6f77616e6365000000600082015250565b6000611253601d83610ca2565b915061125e8261121d565b602082019050919050565b6000602082019050818103600083015261128281611246565b9050919050565b7f45524332303a207472616e736665722066726f6d20746865207a65726f20616460008201527f6472657373000000000000000000000000000000000000000000000000000000602082015250565b60006112e5602583610ca2565b91506112f082611289565b604082019050919050565b60006020820190508181036000830152611314816112d8565b9050919050565b7f45524332303a207472616e7366657220746f20746865207a65726f206164647260008201527f6573730000000000000000000000000000000000000000000000000000000000602082015250565b6000611377602383610ca2565b91506113828261131b565b604082019050919050565b600060208201905081810360008301526113a68161136a565b9050919050565b7f45524332303a207472616e7366657220616d6f756e742065786365656473206260008201527f616c616e63650000000000000000000000000000000000000000000000000000602082015250565b6000611409602683610ca2565b9150611414826113ad565b604082019050919050565b60006020820190508181036000830152611438816113fc565b9050919050565b7f45524332303a206d696e7420746f20746865207a65726f206164647265737300600082015250565b6000611475601f83610ca2565b91506114808261143f565b602082019050919050565b600060208201905081810360008301526114a481611468565b905091905056fea26469706673582212203d770b0b71192b4da834f85e18bc91ff2641d52117201ebf8cf9048ceef1035f64736f6c634300080f0033000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000120000000000000000000000000000000000000000000000000000000000000001360000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000013700000000000000000000000000000000000000000000000000000000000000";

    tx.data = Bytes::from_hex(erc20_deploy_hex).unwrap();
    tx
}

pub fn create_transfer_token_tx(caller: &Address, to: &Address, amount: U256) -> TxEnv {
    let mut tx = TxEnv::default();
    tx.caller = caller.clone();
    tx.transact_to = TransactTo::create();
    let mut data = vec![0xa9, 0x05, 0x9c, 0xbb]; // ERC-20 transfer function selector
    data.extend_from_slice(&to.as_slice());
    data.extend_from_slice(&amount.to_be_bytes_vec());
    tx.data = data.into();
    tx
}
